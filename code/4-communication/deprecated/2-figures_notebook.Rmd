---
title: "2-figures_notebook"
author: "Claire Morton"
date: "1/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
  library("lfe")
  library("lubridate")
  library("ncdf4") 
  library("parallel")
  library("raster")
  library("sf")
  library("tidyverse")
  library("reshape2") # melting in 4-make_figure_options
  library("readxl")
  library(RColorBrewer)
  library(ggthemes)

acs_joined_2009 <- read_csv("../../data/processed/acs_joined_2009.csv")
acs_joined_2014 <- read_csv("../../data/processed/acs_joined_2014.csv")
acs_joined_2019 <- read_csv("../../data/processed/acs_joined_2019.csv")

# acs_joined_2009_2009_wells <- read_csv("../../data/processed/acs_joined_2009_2009_wells.csv")
# acs_joined_2014_2009_wells <- read_csv("../../data/processed/acs_joined_2014_2009_wells.csv")
# acs_joined_2019_2009_wells <- read_csv("../../data/processed/acs_joined_2019_2009_wells.csv")
# 
# acs_joined_2009_2014_wells <- read_csv("../../data/processed/acs_joined_2009_2014_wells.csv")
# acs_joined_2014_2014_wells <- read_csv("../../data/processed/acs_joined_2014_2014_wells.csv")
# acs_joined_2019_2014_wells <- read_csv("../../data/processed/acs_joined_2019_2014_wells.csv")
# 
# acs_joined_2009_2019_wells <- read_csv("../../data/processed/acs_joined_2009_2019_wells.csv")
# acs_joined_2014_2019_wells <- read_csv("../../data/processed/acs_joined_2014_2019_wells.csv")
# acs_joined_2019_2019_wells <- read_csv("../../data/processed/acs_joined_2019_2019_wells.csv")

acs_joined_single_years <- read_rds("../../data/processed/acs_joined_single_years.rds")

```


```{r, echo = FALSE}
# gives you the x in "x proportion of people near wells are __"
get_perc <- function(x, data, var) {
  sum(x * data[var]) / sum(data["Total Population"] * data[var])
}

# gives the x in "x proportion of people outside the radii of wells are __"
get_pop_perc <- function(x, data, var) {
  sum(x * (1 - data[var])) / sum(data["Total Population"] * (1 - data[var]))
}
```


Getting melted datasets for wells with same years as ACS
```{r, echo=FALSE}
perc_2009_762m <- lapply(acs_joined_2009[4:39],  
                         get_perc, 
                         acs_joined_2009, 
                         "buffer_overlap_762m") %>%  # piping for readability, too
  data.frame()
perc_2014_762m <- lapply(acs_joined_2014[4:39], get_perc,  acs_joined_2014, 
                         "buffer_overlap_762m") %>%
  data.frame()
perc_2019_762m <- data.frame(lapply(acs_joined_2019[4:39], get_perc, acs_joined_2019, "buffer_overlap_762m"))

perc_2009_1km <- data.frame(lapply(acs_joined_2009[4:39], get_perc, acs_joined_2009, "buffer_overlap_1km"))
perc_2014_1km <- data.frame(lapply(acs_joined_2014[4:39], get_perc, acs_joined_2014, "buffer_overlap_1km"))
perc_2019_1km <- data.frame(lapply(acs_joined_2019[4:39], get_perc, acs_joined_2019, "buffer_overlap_1km"))

perc_2009_3km <- data.frame(lapply(acs_joined_2009[4:39], get_perc, acs_joined_2009, "buffer_overlap_3km"))
perc_2014_3km <- data.frame(lapply(acs_joined_2014[4:39], get_perc, acs_joined_2014, "buffer_overlap_3km"))
perc_2019_3km <- data.frame(lapply(acs_joined_2019[4:39], get_perc, acs_joined_2019, "buffer_overlap_3km"))

perc_2009_5km <- data.frame(lapply(acs_joined_2009[4:39], get_perc, acs_joined_2009, "buffer_overlap_5km"))
perc_2014_5km <- data.frame(lapply(acs_joined_2014[4:39], get_perc, acs_joined_2014, "buffer_overlap_5km"))
perc_2019_5km <- data.frame(lapply(acs_joined_2019[4:39], get_perc, acs_joined_2019, "buffer_overlap_5km"))

perc_2009_10km <- data.frame(lapply(acs_joined_2009[4:39], get_perc, acs_joined_2009, "buffer_overlap_10km"))
perc_2014_10km <- data.frame(lapply(acs_joined_2014[4:39], get_perc, acs_joined_2014, "buffer_overlap_10km"))
perc_2019_10km <- data.frame(lapply(acs_joined_2019[4:39], get_perc, acs_joined_2019, "buffer_overlap_10km"))


pop_perc_2009_762m <- data.frame(lapply(acs_joined_2009[4:39], get_pop_perc, acs_joined_2009, "buffer_overlap_762m"))
pop_perc_2014_762m <- data.frame(lapply(acs_joined_2014[4:39], get_pop_perc, acs_joined_2014, "buffer_overlap_762m"))
pop_perc_2019_762m <- data.frame(lapply(acs_joined_2019[4:39], get_pop_perc, acs_joined_2019, "buffer_overlap_762m"))

pop_perc_2009_1km <- data.frame(lapply(acs_joined_2009[4:39], get_pop_perc, acs_joined_2009, "buffer_overlap_1km"))
pop_perc_2014_1km <- data.frame(lapply(acs_joined_2014[4:39], get_pop_perc, acs_joined_2014, "buffer_overlap_1km"))
pop_perc_2019_1km <- data.frame(lapply(acs_joined_2019[4:39], get_pop_perc, acs_joined_2019, "buffer_overlap_1km"))

pop_perc_2009_3km <- data.frame(lapply(acs_joined_2009[4:39], get_pop_perc, acs_joined_2009, "buffer_overlap_3km"))
pop_perc_2014_3km <- data.frame(lapply(acs_joined_2014[4:39], get_pop_perc, acs_joined_2014, "buffer_overlap_3km"))
pop_perc_2019_3km <- data.frame(lapply(acs_joined_2019[4:39], get_pop_perc, acs_joined_2019, "buffer_overlap_3km"))

pop_perc_2009_5km <- data.frame(lapply(acs_joined_2009[4:39], get_pop_perc, acs_joined_2009, "buffer_overlap_5km"))
pop_perc_2014_5km <- data.frame(lapply(acs_joined_2014[4:39], get_pop_perc, acs_joined_2014, "buffer_overlap_5km"))
pop_perc_2019_5km <- data.frame(lapply(acs_joined_2019[4:39], get_pop_perc, acs_joined_2019, "buffer_overlap_5km"))

pop_perc_2009_10km <- data.frame(lapply(acs_joined_2009[4:39], get_pop_perc, acs_joined_2009, "buffer_overlap_10km"))
pop_perc_2014_10km <- data.frame(lapply(acs_joined_2014[4:39], get_pop_perc, acs_joined_2014, "buffer_overlap_10km"))
pop_perc_2019_10km <- data.frame(lapply(acs_joined_2019[4:39], get_pop_perc, acs_joined_2019, "buffer_overlap_10km"))



perc_762m <- rbind(perc_2009_762m, perc_2014_762m, perc_2019_762m) %>%
  mutate(year = c(2009, 2014, 2019))

perc_1km <- rbind(perc_2009_1km, perc_2014_1km, perc_2019_1km) %>%
  mutate(year = c(2009, 2014, 2019))

perc_3km <- rbind(perc_2009_3km, perc_2014_3km, perc_2019_3km) %>%
  mutate(year = c(2009, 2014, 2019))

perc_5km <- rbind(perc_2009_5km, perc_2014_5km, perc_2019_5km) %>%
  mutate(year = c(2009, 2014, 2019))

perc_10km <- rbind(perc_2009_10km, perc_2014_10km, perc_2019_10km) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_762m <- rbind(pop_perc_2009_762m, pop_perc_2014_762m, pop_perc_2019_762m) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_1km <- rbind(pop_perc_2009_1km, pop_perc_2014_1km, pop_perc_2019_1km) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_3km <- rbind(pop_perc_2009_3km, pop_perc_2014_3km, pop_perc_2019_3km) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_5km <- rbind(pop_perc_2009_5km, pop_perc_2014_5km, pop_perc_2019_5km) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_10km <- rbind(pop_perc_2009_10km, pop_perc_2014_10km, pop_perc_2019_10km) %>%
  mutate(year = c(2009, 2014, 2019))

melted_perc_762m <- melt(perc_762m, id.vars="year")
melted_pop_perc_762m <- melt(pop_perc_762m, id.vars="year")
melted_perc_1km <- melt(perc_1km, id.vars="year")
melted_pop_perc_1km <- melt(pop_perc_1km, id.vars="year")
melted_perc_3km <- melt(perc_3km, id.vars="year")
melted_pop_perc_3km <- melt(pop_perc_3km, id.vars="year")
melted_perc_5km <- melt(perc_5km, id.vars="year")
melted_pop_perc_5km <- melt(pop_perc_5km, id.vars="year")
melted_perc_10km <- melt(perc_10km, id.vars="year")
melted_pop_perc_10km <- melt(pop_perc_5km, id.vars="year")
```

Getting melted datasets for 2009 wells
```{r, echo=FALSE}
perc_2009_762m_2009_wells <- lapply(acs_joined_2009_2009_wells[4:39],  
                         get_perc, 
                         acs_joined_2009_2009_wells, 
                         "buffer_overlap_762m") %>%  # piping for readability, too
  data.frame()
perc_2014_762m_2009_wells <- lapply(acs_joined_2014_2009_wells[4:39], get_perc,  acs_joined_2014_2009_wells, 
                         "buffer_overlap_762m") %>%
  data.frame()
perc_2019_762m_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_perc, acs_joined_2019_2009_wells, "buffer_overlap_762m"))

perc_2009_1km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_perc, acs_joined_2009_2009_wells, "buffer_overlap_1km"))
perc_2014_1km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_perc, acs_joined_2014_2009_wells, "buffer_overlap_1km"))
perc_2019_1km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_perc, acs_joined_2019_2009_wells, "buffer_overlap_1km"))

perc_2009_3km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_perc, acs_joined_2009_2009_wells, "buffer_overlap_3km"))
perc_2014_3km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_perc, acs_joined_2014_2009_wells, "buffer_overlap_3km"))
perc_2019_3km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_perc, acs_joined_2019_2009_wells, "buffer_overlap_3km"))

perc_2009_5km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_perc, acs_joined_2009_2009_wells, "buffer_overlap_5km"))
perc_2014_5km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_perc, acs_joined_2014_2009_wells, "buffer_overlap_5km"))
perc_2019_5km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_perc, acs_joined_2019_2009_wells, "buffer_overlap_5km"))

perc_2009_10km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_perc, acs_joined_2009_2009_wells, "buffer_overlap_10km"))
perc_2014_10km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_perc, acs_joined_2014_2009_wells, "buffer_overlap_10km"))
perc_2019_10km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_perc, acs_joined_2019_2009_wells, "buffer_overlap_10km"))


pop_perc_2009_762m_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_pop_perc, acs_joined_2009_2009_wells, "buffer_overlap_762m"))
pop_perc_2014_762m_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_pop_perc, acs_joined_2014_2009_wells, "buffer_overlap_762m"))
pop_perc_2019_762m_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_pop_perc, acs_joined_2019_2009_wells, "buffer_overlap_762m"))

pop_perc_2009_1km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_pop_perc, acs_joined_2009_2009_wells, "buffer_overlap_1km"))
pop_perc_2014_1km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_pop_perc, acs_joined_2014_2009_wells, "buffer_overlap_1km"))
pop_perc_2019_1km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_pop_perc, acs_joined_2019_2009_wells, "buffer_overlap_1km"))

pop_perc_2009_3km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_pop_perc, acs_joined_2009_2009_wells, "buffer_overlap_3km"))
pop_perc_2014_3km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_pop_perc, acs_joined_2014_2009_wells, "buffer_overlap_3km"))
pop_perc_2019_3km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_pop_perc, acs_joined_2019_2009_wells, "buffer_overlap_3km"))

pop_perc_2009_5km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_pop_perc, acs_joined_2009_2009_wells, "buffer_overlap_5km"))
pop_perc_2014_5km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_pop_perc, acs_joined_2014_2009_wells, "buffer_overlap_5km"))
pop_perc_2019_5km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_pop_perc, acs_joined_2019_2009_wells, "buffer_overlap_5km"))

pop_perc_2009_10km_2009_wells <- data.frame(lapply(acs_joined_2009_2009_wells[4:39], get_pop_perc, acs_joined_2009_2009_wells, "buffer_overlap_10km"))
pop_perc_2014_10km_2009_wells <- data.frame(lapply(acs_joined_2014_2009_wells[4:39], get_pop_perc, acs_joined_2014_2009_wells, "buffer_overlap_10km"))
pop_perc_2019_10km_2009_wells <- data.frame(lapply(acs_joined_2019_2009_wells[4:39], get_pop_perc, acs_joined_2019_2009_wells, "buffer_overlap_10km"))



perc_762m_2009_wells <- rbind(perc_2009_762m_2009_wells, perc_2014_762m_2009_wells, perc_2019_762m_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_1km_2009_wells <- rbind(perc_2009_1km_2009_wells, perc_2014_1km_2009_wells, perc_2019_1km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_3km_2009_wells <- rbind(perc_2009_3km_2009_wells, perc_2014_3km_2009_wells, perc_2019_3km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_5km_2009_wells <- rbind(perc_2009_5km_2009_wells, perc_2014_5km_2009_wells, perc_2019_5km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_10km_2009_wells <- rbind(perc_2009_10km_2009_wells, perc_2014_10km_2009_wells, perc_2019_10km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_762m_2009_wells <- rbind(pop_perc_2009_762m_2009_wells, pop_perc_2014_762m_2009_wells, pop_perc_2019_762m_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_1km_2009_wells <- rbind(pop_perc_2009_1km_2009_wells, pop_perc_2014_1km_2009_wells, pop_perc_2019_1km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_3km_2009_wells <- rbind(pop_perc_2009_3km_2009_wells, pop_perc_2014_3km_2009_wells, pop_perc_2019_3km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_5km_2009_wells <- rbind(pop_perc_2009_5km_2009_wells, pop_perc_2014_5km_2009_wells, pop_perc_2019_5km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_10km_2009_wells <- rbind(pop_perc_2009_10km_2009_wells, pop_perc_2014_10km_2009_wells, pop_perc_2019_10km_2009_wells) %>%
  mutate(year = c(2009, 2014, 2019))

melted_perc_762m_2009_wells <- melt(perc_762m_2009_wells, id.vars="year")
melted_pop_perc_762m_2009_wells <- melt(pop_perc_762m_2009_wells, id.vars="year")
melted_perc_1km_2009_wells <- melt(perc_1km_2009_wells, id.vars="year")
melted_pop_perc_1km_2009_wells <- melt(pop_perc_1km_2009_wells, id.vars="year")
melted_perc_3km_2009_wells <- melt(perc_3km_2009_wells, id.vars="year")
melted_pop_perc_3km_2009_wells <- melt(pop_perc_3km_2009_wells, id.vars="year")
melted_perc_5km_2009_wells <- melt(perc_5km_2009_wells, id.vars="year")
melted_pop_perc_5km_2009_wells <- melt(pop_perc_5km_2009_wells, id.vars="year")
melted_perc_10km_2009_wells <- melt(perc_10km_2009_wells, id.vars="year")
melted_pop_perc_10km_2009_wells <- melt(pop_perc_5km_2009_wells, id.vars="year")
```

Getting melted datasets for 2014 wells
```{r, echo=FALSE}
perc_2009_762m_2014_wells <- lapply(acs_joined_2009_2014_wells[4:39],  
                         get_perc, 
                         acs_joined_2009_2014_wells, 
                         "buffer_overlap_762m") %>%  # piping for readability, too
  data.frame()
perc_2014_762m_2014_wells <- lapply(acs_joined_2014_2014_wells[4:39], get_perc,  acs_joined_2014_2014_wells, 
                         "buffer_overlap_762m") %>%
  data.frame()
perc_2019_762m_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_perc, acs_joined_2019_2014_wells, "buffer_overlap_762m"))

perc_2009_1km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_perc, acs_joined_2009_2014_wells, "buffer_overlap_1km"))
perc_2014_1km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_perc, acs_joined_2014_2014_wells, "buffer_overlap_1km"))
perc_2019_1km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_perc, acs_joined_2019_2014_wells, "buffer_overlap_1km"))

perc_2009_3km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_perc, acs_joined_2009_2014_wells, "buffer_overlap_3km"))
perc_2014_3km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_perc, acs_joined_2014_2014_wells, "buffer_overlap_3km"))
perc_2019_3km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_perc, acs_joined_2019_2014_wells, "buffer_overlap_3km"))

perc_2009_5km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_perc, acs_joined_2009_2014_wells, "buffer_overlap_5km"))
perc_2014_5km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_perc, acs_joined_2014_2014_wells, "buffer_overlap_5km"))
perc_2019_5km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_perc, acs_joined_2019_2014_wells, "buffer_overlap_5km"))

perc_2009_10km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_perc, acs_joined_2009_2014_wells, "buffer_overlap_10km"))
perc_2014_10km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_perc, acs_joined_2014_2014_wells, "buffer_overlap_10km"))
perc_2019_10km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_perc, acs_joined_2019_2014_wells, "buffer_overlap_10km"))


pop_perc_2009_762m_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_pop_perc, acs_joined_2009_2014_wells, "buffer_overlap_762m"))
pop_perc_2014_762m_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_pop_perc, acs_joined_2014_2014_wells, "buffer_overlap_762m"))
pop_perc_2019_762m_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_pop_perc, acs_joined_2019_2014_wells, "buffer_overlap_762m"))

pop_perc_2009_1km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_pop_perc, acs_joined_2009_2014_wells, "buffer_overlap_1km"))
pop_perc_2014_1km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_pop_perc, acs_joined_2014_2014_wells, "buffer_overlap_1km"))
pop_perc_2019_1km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_pop_perc, acs_joined_2019_2014_wells, "buffer_overlap_1km"))

pop_perc_2009_3km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_pop_perc, acs_joined_2009_2014_wells, "buffer_overlap_3km"))
pop_perc_2014_3km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_pop_perc, acs_joined_2014_2014_wells, "buffer_overlap_3km"))
pop_perc_2019_3km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_pop_perc, acs_joined_2019_2014_wells, "buffer_overlap_3km"))

pop_perc_2009_5km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_pop_perc, acs_joined_2009_2014_wells, "buffer_overlap_5km"))
pop_perc_2014_5km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_pop_perc, acs_joined_2014_2014_wells, "buffer_overlap_5km"))
pop_perc_2019_5km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_pop_perc, acs_joined_2019_2014_wells, "buffer_overlap_5km"))

pop_perc_2009_10km_2014_wells <- data.frame(lapply(acs_joined_2009_2014_wells[4:39], get_pop_perc, acs_joined_2009_2014_wells, "buffer_overlap_10km"))
pop_perc_2014_10km_2014_wells <- data.frame(lapply(acs_joined_2014_2014_wells[4:39], get_pop_perc, acs_joined_2014_2014_wells, "buffer_overlap_10km"))
pop_perc_2019_10km_2014_wells <- data.frame(lapply(acs_joined_2019_2014_wells[4:39], get_pop_perc, acs_joined_2019_2014_wells, "buffer_overlap_10km"))



perc_762m_2014_wells <- rbind(perc_2009_762m_2014_wells, perc_2014_762m_2014_wells, perc_2019_762m_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_1km_2014_wells <- rbind(perc_2009_1km_2014_wells, perc_2014_1km_2014_wells, perc_2019_1km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_3km_2014_wells <- rbind(perc_2009_3km_2014_wells, perc_2014_3km_2014_wells, perc_2019_3km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_5km_2014_wells <- rbind(perc_2009_5km_2014_wells, perc_2014_5km_2014_wells, perc_2019_5km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_10km_2014_wells <- rbind(perc_2009_10km_2014_wells, perc_2014_10km_2014_wells, perc_2019_10km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_762m_2014_wells <- rbind(pop_perc_2009_762m_2014_wells, pop_perc_2014_762m_2014_wells, pop_perc_2019_762m_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_1km_2014_wells <- rbind(pop_perc_2009_1km_2014_wells, pop_perc_2014_1km_2014_wells, pop_perc_2019_1km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_3km_2014_wells <- rbind(pop_perc_2009_3km_2014_wells, pop_perc_2014_3km_2014_wells, pop_perc_2019_3km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_5km_2014_wells <- rbind(pop_perc_2009_5km_2014_wells, pop_perc_2014_5km_2014_wells, pop_perc_2019_5km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_10km_2014_wells <- rbind(pop_perc_2009_10km_2014_wells, pop_perc_2014_10km_2014_wells, pop_perc_2019_10km_2014_wells) %>%
  mutate(year = c(2009, 2014, 2019))

melted_perc_762m_2014_wells <- melt(perc_762m_2014_wells, id.vars="year")
melted_pop_perc_762m_2014_wells <- melt(pop_perc_762m_2014_wells, id.vars="year")
melted_perc_1km_2014_wells <- melt(perc_1km_2014_wells, id.vars="year")
melted_pop_perc_1km_2014_wells <- melt(pop_perc_1km_2014_wells, id.vars="year")
melted_perc_3km_2014_wells <- melt(perc_3km_2014_wells, id.vars="year")
melted_pop_perc_3km_2014_wells <- melt(pop_perc_3km_2014_wells, id.vars="year")
melted_perc_5km_2014_wells <- melt(perc_5km_2014_wells, id.vars="year")
melted_pop_perc_5km_2014_wells <- melt(pop_perc_5km_2014_wells, id.vars="year")
melted_perc_10km_2014_wells <- melt(perc_10km_2014_wells, id.vars="year")
melted_pop_perc_10km_2014_wells <- melt(pop_perc_5km_2014_wells, id.vars="year")
```

Getting melted datasets for 2019 wells
```{r, echo=FALSE}
perc_2009_762m_2019_wells <- lapply(acs_joined_2009_2019_wells[4:39],  
                         get_perc, 
                         acs_joined_2009_2019_wells, 
                         "buffer_overlap_762m") %>%  # piping for readability, too
  data.frame()
perc_2014_762m_2019_wells <- lapply(acs_joined_2014_2019_wells[4:39], get_perc,  acs_joined_2014_2019_wells, 
                         "buffer_overlap_762m") %>%
  data.frame()
perc_2019_762m_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_perc, acs_joined_2019_2019_wells, "buffer_overlap_762m"))

perc_2009_1km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_perc, acs_joined_2009_2019_wells, "buffer_overlap_1km"))
perc_2014_1km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_perc, acs_joined_2014_2019_wells, "buffer_overlap_1km"))
perc_2019_1km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_perc, acs_joined_2019_2019_wells, "buffer_overlap_1km"))

perc_2009_3km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_perc, acs_joined_2009_2019_wells, "buffer_overlap_3km"))
perc_2014_3km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_perc, acs_joined_2014_2019_wells, "buffer_overlap_3km"))
perc_2019_3km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_perc, acs_joined_2019_2019_wells, "buffer_overlap_3km"))

perc_2009_5km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_perc, acs_joined_2009_2019_wells, "buffer_overlap_5km"))
perc_2014_5km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_perc, acs_joined_2014_2019_wells, "buffer_overlap_5km"))
perc_2019_5km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_perc, acs_joined_2019_2019_wells, "buffer_overlap_5km"))

perc_2009_10km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_perc, acs_joined_2009_2019_wells, "buffer_overlap_10km"))
perc_2014_10km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_perc, acs_joined_2014_2019_wells, "buffer_overlap_10km"))
perc_2019_10km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_perc, acs_joined_2019_2019_wells, "buffer_overlap_10km"))


pop_perc_2009_762m_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_pop_perc, acs_joined_2009_2019_wells, "buffer_overlap_762m"))
pop_perc_2014_762m_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_pop_perc, acs_joined_2014_2019_wells, "buffer_overlap_762m"))
pop_perc_2019_762m_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_pop_perc, acs_joined_2019_2019_wells, "buffer_overlap_762m"))

pop_perc_2009_1km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_pop_perc, acs_joined_2009_2019_wells, "buffer_overlap_1km"))
pop_perc_2014_1km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_pop_perc, acs_joined_2014_2019_wells, "buffer_overlap_1km"))
pop_perc_2019_1km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_pop_perc, acs_joined_2019_2019_wells, "buffer_overlap_1km"))

pop_perc_2009_3km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_pop_perc, acs_joined_2009_2019_wells, "buffer_overlap_3km"))
pop_perc_2014_3km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_pop_perc, acs_joined_2014_2019_wells, "buffer_overlap_3km"))
pop_perc_2019_3km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_pop_perc, acs_joined_2019_2019_wells, "buffer_overlap_3km"))

pop_perc_2009_5km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_pop_perc, acs_joined_2009_2019_wells, "buffer_overlap_5km"))
pop_perc_2014_5km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_pop_perc, acs_joined_2014_2019_wells, "buffer_overlap_5km"))
pop_perc_2019_5km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_pop_perc, acs_joined_2019_2019_wells, "buffer_overlap_5km"))

pop_perc_2009_10km_2019_wells <- data.frame(lapply(acs_joined_2009_2019_wells[4:39], get_pop_perc, acs_joined_2009_2019_wells, "buffer_overlap_10km"))
pop_perc_2014_10km_2019_wells <- data.frame(lapply(acs_joined_2014_2019_wells[4:39], get_pop_perc, acs_joined_2014_2019_wells, "buffer_overlap_10km"))
pop_perc_2019_10km_2019_wells <- data.frame(lapply(acs_joined_2019_2019_wells[4:39], get_pop_perc, acs_joined_2019_2019_wells, "buffer_overlap_10km"))



perc_762m_2019_wells <- rbind(perc_2009_762m_2019_wells, perc_2014_762m_2019_wells, perc_2019_762m_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_1km_2019_wells <- rbind(perc_2009_1km_2019_wells, perc_2014_1km_2019_wells, perc_2019_1km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_3km_2019_wells <- rbind(perc_2009_3km_2019_wells, perc_2014_3km_2019_wells, perc_2019_3km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_5km_2019_wells <- rbind(perc_2009_5km_2019_wells, perc_2014_5km_2019_wells, perc_2019_5km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

perc_10km_2019_wells <- rbind(perc_2009_10km_2019_wells, perc_2014_10km_2019_wells, perc_2019_10km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_762m_2019_wells <- rbind(pop_perc_2009_762m_2019_wells, pop_perc_2014_762m_2019_wells, pop_perc_2019_762m_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_1km_2019_wells <- rbind(pop_perc_2009_1km_2019_wells, pop_perc_2014_1km_2019_wells, pop_perc_2019_1km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_3km_2019_wells <- rbind(pop_perc_2009_3km_2019_wells, pop_perc_2014_3km_2019_wells, pop_perc_2019_3km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_5km_2019_wells <- rbind(pop_perc_2009_5km_2019_wells, pop_perc_2014_5km_2019_wells, pop_perc_2019_5km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

pop_perc_10km_2019_wells <- rbind(pop_perc_2009_10km_2019_wells, pop_perc_2014_10km_2019_wells, pop_perc_2019_10km_2019_wells) %>%
  mutate(year = c(2009, 2014, 2019))

melted_perc_762m_2019_wells <- melt(perc_762m_2019_wells, id.vars="year")
melted_pop_perc_762m_2019_wells <- melt(pop_perc_762m_2019_wells, id.vars="year")
melted_perc_1km_2019_wells <- melt(perc_1km_2019_wells, id.vars="year")
melted_pop_perc_1km_2019_wells <- melt(pop_perc_1km_2019_wells, id.vars="year")
melted_perc_3km_2019_wells <- melt(perc_3km_2019_wells, id.vars="year")
melted_pop_perc_3km_2019_wells <- melt(pop_perc_3km_2019_wells, id.vars="year")
melted_perc_5km_2019_wells <- melt(perc_5km_2019_wells, id.vars="year")
melted_pop_perc_5km_2019_wells <- melt(pop_perc_5km_2019_wells, id.vars="year")
melted_perc_10km_2019_wells <- melt(perc_10km_2019_wells, id.vars="year")
melted_pop_perc_10km_2019_wells <- melt(pop_perc_5km_2019_wells, id.vars="year")
```

Plot race with three sets of time wells
```{r, echo = FALSE}
# race_eth
race_eth_2009 <- melted_perc_3km_2009_wells[c(1:36),]
race_eth_pop_2009 <- melted_pop_perc_3km_2009_wells[c(1:36),]
race_eth_2014 <- melted_perc_3km_2014_wells[c(1:36),]
race_eth_pop_2014 <- melted_pop_perc_3km_2014_wells[c(1:36),]
race_eth_2019 <- melted_perc_3km_2019_wells[c(1:36),]
race_eth_pop_2019 <- melted_pop_perc_3km_2019_wells[c(1:36),]
library(RColorBrewer)
plot_2009 <- ggplot(race_eth_2009) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = race_eth_pop_2009, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(race_eth_2014) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = race_eth_pop_2014, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(race_eth_2019) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = race_eth_pop_2019, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Plot education with three sets of wells
```{r, echo = FALSE}
# race_eth
edu_2009 <- melted_perc_3km_2009_wells[c(37:39, 85:108),]
edu_pop_2009 <- melted_pop_perc_3km_2009_wells[c(37:39, 85:108),]
edu_2014 <- melted_perc_3km_2014_wells[c(37:39, 85:108),]
edu_pop_2014 <- melted_pop_perc_3km_2014_wells[c(37:39, 85:108),]
edu_2019 <- melted_perc_3km_2019_wells[c(37:39, 85:108),]
edu_pop_2019 <- melted_pop_perc_3km_2019_wells[c(37:39, 85:108),]
library(RColorBrewer)
plot_2009 <- ggplot(edu_2009) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = edu_pop_2009, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(edu_2014) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = edu_pop_2014, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(edu_2019) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = edu_pop_2019, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Plot poverty with three sets of wells
```{r, echo = FALSE}
# race_eth
pov_2009 <- melted_perc_3km_2009_wells[c(40:48),]
pov_pop_2009 <- melted_pop_perc_3km_2009_wells[c(40:48),]
pov_2014 <- melted_perc_3km_2014_wells[c(40:48),]
pov_pop_2014 <- melted_pop_perc_3km_2014_wells[c(40:48),]
pov_2019 <- melted_perc_3km_2019_wells[c(40:48),]
pov_pop_2019 <- melted_pop_perc_3km_2019_wells[c(40:48),]
library(RColorBrewer)
plot_2009 <- ggplot(pov_2009) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = pov_pop_2009, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(pov_2014) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = pov_pop_2014, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(pov_2019) +
             geom_line(aes(x = year, y = value, group = variable, color = variable)) +
             geom_line(data = pov_pop_2019, aes(x = year, y = value, group = variable, color = variable), linetype = "dashed") +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Looking at race/ethnicity ratios
```{r, echo = FALSE}
# race_eth
race_eth_2009 <- melted_perc_3km_2009_wells[c(1:36),]
race_eth_pop_2009 <- melted_pop_perc_3km_2009_wells[c(1:36),]
race_eth_2014 <- melted_perc_3km_2014_wells[c(1:36),]
race_eth_pop_2014 <- melted_pop_perc_3km_2014_wells[c(1:36),]
race_eth_2019 <- melted_perc_3km_2019_wells[c(1:36),]
race_eth_pop_2019 <- melted_pop_perc_3km_2019_wells[c(1:36),]

plot_2009 <- ggplot(race_eth_2009) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(race_eth_2014) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(race_eth_2019) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Plot education with three sets of wells
```{r, echo = FALSE}
# race_eth
edu_2009 <- melted_perc_3km_2009_wells[c(37:39, 85:108),]
edu_pop_2009 <- melted_pop_perc_3km_2009_wells[c(37:39, 85:108),]
edu_2014 <- melted_perc_3km_2014_wells[c(37:39, 85:108),]
edu_pop_2014 <- melted_pop_perc_3km_2014_wells[c(37:39, 85:108),]
edu_2019 <- melted_perc_3km_2019_wells[c(37:39, 85:108),]
edu_pop_2019 <- melted_pop_perc_3km_2019_wells[c(37:39, 85:108),]
library(RColorBrewer)
plot_2009 <- ggplot(edu_2009) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(edu_2014) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(edu_2019) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Looking at poverty ratios
```{r, echo = FALSE}
# race_eth
pov_2009 <- melted_perc_3km_2009_wells[c(40:48),]
pov_pop_2009 <- melted_pop_perc_3km_2009_wells[c(40:48),]
pov_2014 <- melted_perc_3km_2014_wells[c(40:48),]
pov_pop_2014 <- melted_pop_perc_3km_2014_wells[c(40:48),]
pov_2019 <- melted_perc_3km_2019_wells[c(40:48),]
pov_pop_2019 <- melted_pop_perc_3km_2019_wells[c(40:48),]
library(RColorBrewer)
library(ggthemes)
plot_2009 <- ggplot(pov_2009) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2009") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2014 <- ggplot(pov_2014) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2014") +
             theme (legend.position = "none") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2019 <- ggplot(pov_2019) +
             geom_line(aes(x = year, y = value/pov_pop_2009$value, group = variable, color = variable)) +
             ggtitle ("Radius 3km, 2019") +
             theme_hc(bgcolor = "darkunica") +
             scale_color_brewer(palette = "Set3")
plot_2009
plot_2014
plot_2019
```

Dealing with the single dataset with PREPRODUCTION information for all years by year
```{r, echo = FALSE}
acs_joined_single_years <- read_rds ("../../data/processed/acs_joined_single_years.rds")  %>%
  mutate("More Than High School Diploma" = rowSums(acs_joined_single_years[,c(34:39)])) %>% #Add more than high school diploma column
  select(c(1:39, 44, 40:43)) #reorder columns
summary_762m <- acs_joined_single_years %>%
  mutate ("Total Population 762m" = 
            acs_joined_single_years$"Total Population"*buffer_overlap_762m,
          "White Alone 762m" = 
            acs_joined_single_years$"White Alone"*buffer_overlap_762m,
          "Black or African American Alone 762m" = 
            acs_joined_single_years$"Black or African American Alone"*buffer_overlap_762m,
          "American Indian and Alaska Native Alone 762m" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*buffer_overlap_762m,
          "Asian Alone 762m" = 
            acs_joined_single_years$"Asian Alone"*buffer_overlap_762m,
          "Native Hawaiian and Other Pacific Islander Alone 762m" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*buffer_overlap_762m,
          "Some Other Race Alone 762m" = 
            acs_joined_single_years$"Some Other Race Alone"*buffer_overlap_762m,
          "Two or More Races 762m" = 
            acs_joined_single_years$"Two or More Races"*buffer_overlap_762m,
          "Two Races Including Some Other Race 762m" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*buffer_overlap_762m,
          "Two Races Excluding Some Other Race, And Three or More Races 762m" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*buffer_overlap_762m,
          "Not Hispanic or Latino 762m" = 
            acs_joined_single_years$"Not Hispanic or Latino"*buffer_overlap_762m,
          "Hispanic or Latino 762m" = 
            acs_joined_single_years$"Hispanic or Latino"*buffer_overlap_762m,
          
          "Household Poverty Universe 762m" = 
            acs_joined_single_years$"Household Poverty Universe"*buffer_overlap_762m,
          "Income in Past 12 Months Below Poverty Level 762m" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*buffer_overlap_762m, 
          "Income in Past 12 Months at or Above Poverty Level 762m" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*buffer_overlap_762m,
          
          "Education Universe 762m" = 
            acs_joined_single_years$"Education Universe"*buffer_overlap_762m,
          "Less Than High School Diploma 762m" = 
            acs_joined_single_years$"Less Than High School Diploma"*buffer_overlap_762m,
          "High School Diploma 762m" =
            acs_joined_single_years$"High School Diploma"*buffer_overlap_762m,
          "Some College 762m" =
            acs_joined_single_years$"Some College"*buffer_overlap_762m,
          "Associate's Degree 762m" =
            acs_joined_single_years$"Associate's Degree"*buffer_overlap_762m,
          "Bachelor's Degree 762m" =
            acs_joined_single_years$"Bachelor's Degree"*buffer_overlap_762m,
          "Master's Degree 762m" =
            acs_joined_single_years$"Master's Degree"*buffer_overlap_762m,
          "Professional School Degree 762m" =
            acs_joined_single_years$"Professional School Degree"*buffer_overlap_762m,
          "Doctorate Degree 762m" =
            acs_joined_single_years$"Doctorate Degree"*buffer_overlap_762m,
          "More Than High School Diploma 762m" =
            acs_joined_single_years$"More Than High School Diploma"*buffer_overlap_762m) %>%
  select(c(43:69))

summary_762m <- summary_762m[,-c(1)] %>%
  aggregate (by = data.frame(summary_762m$year), sum)

summary_762m <- cbind(summary_762m[, c(1)], 
                      summary_762m[,c(2:13)]/summary_762m$"Total Population 762m", 
                      summary_762m[,c(14:16)]/summary_762m$"Household Poverty Universe 762m",
                      summary_762m[,c(17:27)]/summary_762m$"Education Universe 762m")



summary_1km <- acs_joined_single_years %>%
  mutate ("Total Population 1km" = 
            acs_joined_single_years$"Total Population"*buffer_overlap_1km,
          "White Alone 1km" = 
            acs_joined_single_years$"White Alone"*buffer_overlap_1km,
          "Black or African American Alone 1km" = 
            acs_joined_single_years$"Black or African American Alone"*buffer_overlap_1km,
          "American Indian and Alaska Native Alone 1km" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*buffer_overlap_1km,
          "Asian Alone 1km" = 
            acs_joined_single_years$"Asian Alone"*buffer_overlap_1km,
          "Native Hawaiian and Other Pacific Islander Alone 1km" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*buffer_overlap_1km,
          "Some Other Race Alone 1km" = 
            acs_joined_single_years$"Some Other Race Alone"*buffer_overlap_1km,
          "Two or More Races 1km" = 
            acs_joined_single_years$"Two or More Races"*buffer_overlap_1km,
          "Two Races Including Some Other Race 1km" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*buffer_overlap_1km,
          "Two Races Excluding Some Other Race, And Three or More Races 1km" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*buffer_overlap_1km,
          "Not Hispanic or Latino 1km" = 
            acs_joined_single_years$"Not Hispanic or Latino"*buffer_overlap_1km,
          "Hispanic or Latino 1km" = 
            acs_joined_single_years$"Hispanic or Latino"*buffer_overlap_1km,
          
          "Household Poverty Universe 1km" = 
            acs_joined_single_years$"Household Poverty Universe"*buffer_overlap_1km,
          "Income in Past 12 Months Below Poverty Level 1km" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*buffer_overlap_1km, 
          "Income in Past 12 Months at or Above Poverty Level 1km" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*buffer_overlap_1km,
          
          "Education Universe 1km" = 
            acs_joined_single_years$"Education Universe"*buffer_overlap_1km,
          "Less Than High School Diploma 1km" = 
            acs_joined_single_years$"Less Than High School Diploma"*buffer_overlap_1km,
          "High School Diploma 1km" =
            acs_joined_single_years$"High School Diploma"*buffer_overlap_1km,
          "Some College 1km" =
            acs_joined_single_years$"Some College"*buffer_overlap_1km,
          "Associate's Degree 1km" =
            acs_joined_single_years$"Associate's Degree"*buffer_overlap_1km,
          "Bachelor's Degree 1km" =
            acs_joined_single_years$"Bachelor's Degree"*buffer_overlap_1km,
          "Master's Degree 1km" =
            acs_joined_single_years$"Master's Degree"*buffer_overlap_1km,
          "Professional School Degree 1km" =
            acs_joined_single_years$"Professional School Degree"*buffer_overlap_1km,
          "Doctorate Degree 1km" =
            acs_joined_single_years$"Doctorate Degree"*buffer_overlap_1km,
          "More Than High School Diploma 1km" =
            acs_joined_single_years$"More Than High School Diploma"*buffer_overlap_1km) %>%
  select(c(43:69))

summary_1km <- summary_1km[,-c(1)] %>%
  aggregate (by = data.frame(summary_1km$year), sum)

summary_1km <- cbind(summary_1km[, c(1)], 
                      summary_1km[,c(2:13)]/summary_1km$"Total Population 1km", 
                      summary_1km[,c(14:16)]/summary_1km$"Household Poverty Universe 1km",
                      summary_1km[,c(17:27)]/summary_1km$"Education Universe 1km")



summary_3km <- acs_joined_single_years %>%
  mutate ("Total Population 3km" = 
            acs_joined_single_years$"Total Population"*buffer_overlap_3km,
          "White Alone 3km" = 
            acs_joined_single_years$"White Alone"*buffer_overlap_3km,
          "Black or African American Alone 3km" = 
            acs_joined_single_years$"Black or African American Alone"*buffer_overlap_3km,
          "American Indian and Alaska Native Alone 3km" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*buffer_overlap_3km,
          "Asian Alone 3km" = 
            acs_joined_single_years$"Asian Alone"*buffer_overlap_3km,
          "Native Hawaiian and Other Pacific Islander Alone 3km" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*buffer_overlap_3km,
          "Some Other Race Alone 3km" = 
            acs_joined_single_years$"Some Other Race Alone"*buffer_overlap_3km,
          "Two or More Races 3km" = 
            acs_joined_single_years$"Two or More Races"*buffer_overlap_3km,
          "Two Races Including Some Other Race 3km" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*buffer_overlap_3km,
          "Two Races Excluding Some Other Race, And Three or More Races 3km" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*buffer_overlap_3km,
          "Not Hispanic or Latino 3km" = 
            acs_joined_single_years$"Not Hispanic or Latino"*buffer_overlap_3km,
          "Hispanic or Latino 3km" = 
            acs_joined_single_years$"Hispanic or Latino"*buffer_overlap_3km,
          
          "Household Poverty Universe 3km" = 
            acs_joined_single_years$"Household Poverty Universe"*buffer_overlap_3km,
          "Income in Past 12 Months Below Poverty Level 3km" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*buffer_overlap_3km, 
          "Income in Past 12 Months at or Above Poverty Level 3km" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*buffer_overlap_3km,
          
          "Education Universe 3km" = 
            acs_joined_single_years$"Education Universe"*buffer_overlap_3km,
          "Less Than High School Diploma 3km" = 
            acs_joined_single_years$"Less Than High School Diploma"*buffer_overlap_3km,
          "High School Diploma 3km" =
            acs_joined_single_years$"High School Diploma"*buffer_overlap_3km,
          "Some College 3km" =
            acs_joined_single_years$"Some College"*buffer_overlap_3km,
          "Associate's Degree 3km" =
            acs_joined_single_years$"Associate's Degree"*buffer_overlap_3km,
          "Bachelor's Degree 3km" =
            acs_joined_single_years$"Bachelor's Degree"*buffer_overlap_3km,
          "Master's Degree 3km" =
            acs_joined_single_years$"Master's Degree"*buffer_overlap_3km,
          "Professional School Degree 3km" =
            acs_joined_single_years$"Professional School Degree"*buffer_overlap_3km,
          "Doctorate Degree 3km" =
            acs_joined_single_years$"Doctorate Degree"*buffer_overlap_3km,
          "More Than High School Diploma 3km" =
            acs_joined_single_years$"More Than High School Diploma"*buffer_overlap_3km) %>%
  select(c(43:69))

summary_3km <- summary_3km[,-c(1)] %>%
  aggregate (by = data.frame(summary_3km$year), sum)

summary_3km <- cbind(summary_3km[, c(1)], 
                      summary_3km[,c(2:13)]/summary_3km$"Total Population 3km", 
                      summary_3km[,c(14:16)]/summary_3km$"Household Poverty Universe 3km",
                      summary_3km[,c(17:27)]/summary_3km$"Education Universe 3km")


summary_762m_outside <- acs_joined_single_years %>%
  mutate ("Total Population 762m" = 
            acs_joined_single_years$"Total Population"*(1-buffer_overlap_762m),
          "White Alone 762m" = 
            acs_joined_single_years$"White Alone"*(1-buffer_overlap_762m),
          "Black or African American Alone 762m" = 
            acs_joined_single_years$"Black or African American Alone"*(1-buffer_overlap_762m),
          "American Indian and Alaska Native Alone 762m" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*(1-buffer_overlap_762m),
          "Asian Alone 762m" = 
            acs_joined_single_years$"Asian Alone"*(1-buffer_overlap_762m),
          "Native Hawaiian and Other Pacific Islander Alone 762m" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*(1-buffer_overlap_762m),
          "Some Other Race Alone 762m" = 
            acs_joined_single_years$"Some Other Race Alone"*(1-buffer_overlap_762m),
          "Two or More Races 762m" = 
            acs_joined_single_years$"Two or More Races"*(1-buffer_overlap_762m),
          "Two Races Including Some Other Race 762m" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*(1-buffer_overlap_762m),
          "Two Races Excluding Some Other Race, And Three or More Races 762m" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*(1-buffer_overlap_762m),
          "Not Hispanic or Latino 762m" = 
            acs_joined_single_years$"Not Hispanic or Latino"*(1-buffer_overlap_762m),
          "Hispanic or Latino 762m" = 
            acs_joined_single_years$"Hispanic or Latino"*(1-buffer_overlap_762m),
          
          "Household Poverty Universe 762m" = 
            acs_joined_single_years$"Household Poverty Universe"*(1-buffer_overlap_762m),
          "Income in Past 12 Months Below Poverty Level 762m" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*(1-buffer_overlap_762m), 
          "Income in Past 12 Months at or Above Poverty Level 762m" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*(1-buffer_overlap_762m),
          
          "Education Universe 762m" = 
            acs_joined_single_years$"Education Universe"*(1-buffer_overlap_762m),
          "Less Than High School Diploma 762m" = 
            acs_joined_single_years$"Less Than High School Diploma"*(1-buffer_overlap_762m),
          "High School Diploma 762m" =
            acs_joined_single_years$"High School Diploma"*(1-buffer_overlap_762m),
          "Some College 762m" =
            acs_joined_single_years$"Some College"*(1-buffer_overlap_762m),
          "Associate's Degree 762m" =
            acs_joined_single_years$"Associate's Degree"*(1-buffer_overlap_762m),
          "Bachelor's Degree 762m" =
            acs_joined_single_years$"Bachelor's Degree"*(1-buffer_overlap_762m),
          "Master's Degree 762m" =
            acs_joined_single_years$"Master's Degree"*(1-buffer_overlap_762m),
          "Professional School Degree 762m" =
            acs_joined_single_years$"Professional School Degree"*(1-buffer_overlap_762m),
          "Doctorate Degree 762m" =
            acs_joined_single_years$"Doctorate Degree"*(1-buffer_overlap_762m),
          "More Than High School Diploma 762m" =
            acs_joined_single_years$"More Than High School Diploma"*(1-buffer_overlap_762m)) %>%
  select(c(43:69))

summary_762m_outside <- summary_762m_outside[,-c(1)] %>%
  aggregate (by = data.frame(summary_762m_outside$year), sum)

summary_762m_outside <- cbind(summary_762m_outside[, c(1)], 
                      summary_762m_outside[,c(2:13)]/summary_762m_outside$"Total Population 762m", 
                      summary_762m_outside[,c(14:16)]/summary_762m_outside$"Household Poverty Universe 762m",
                      summary_762m_outside[,c(17:27)]/summary_762m_outside$"Education Universe 762m")




summary_1km_outside <- acs_joined_single_years %>%
  mutate ("Total Population 1km" = 
            acs_joined_single_years$"Total Population"*(1-buffer_overlap_1km),
          "White Alone 1km" = 
            acs_joined_single_years$"White Alone"*(1-buffer_overlap_1km),
          "Black or African American Alone 1km" = 
            acs_joined_single_years$"Black or African American Alone"*(1-buffer_overlap_1km),
          "American Indian and Alaska Native Alone 1km" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*(1-buffer_overlap_1km),
          "Asian Alone 1km" = 
            acs_joined_single_years$"Asian Alone"*(1-buffer_overlap_1km),
          "Native Hawaiian and Other Pacific Islander Alone 1km" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*(1-buffer_overlap_1km),
          "Some Other Race Alone 1km" = 
            acs_joined_single_years$"Some Other Race Alone"*(1-buffer_overlap_1km),
          "Two or More Races 1km" = 
            acs_joined_single_years$"Two or More Races"*(1-buffer_overlap_1km),
          "Two Races Including Some Other Race 1km" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*(1-buffer_overlap_1km),
          "Two Races Excluding Some Other Race, And Three or More Races 1km" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*(1-buffer_overlap_1km),
          "Not Hispanic or Latino 1km" = 
            acs_joined_single_years$"Not Hispanic or Latino"*(1-buffer_overlap_1km),
          "Hispanic or Latino 1km" = 
            acs_joined_single_years$"Hispanic or Latino"*(1-buffer_overlap_1km),
          
          "Household Poverty Universe 1km" = 
            acs_joined_single_years$"Household Poverty Universe"*(1-buffer_overlap_1km),
          "Income in Past 12 Months Below Poverty Level 1km" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*(1-buffer_overlap_1km), 
          "Income in Past 12 Months at or Above Poverty Level 1km" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*(1-buffer_overlap_1km),
          
          "Education Universe 1km" = 
            acs_joined_single_years$"Education Universe"*(1-buffer_overlap_1km),
          "Less Than High School Diploma 1km" = 
            acs_joined_single_years$"Less Than High School Diploma"*(1-buffer_overlap_1km),
          "High School Diploma 1km" =
            acs_joined_single_years$"High School Diploma"*(1-buffer_overlap_1km),
          "Some College 1km" =
            acs_joined_single_years$"Some College"*(1-buffer_overlap_1km),
          "Associate's Degree 1km" =
            acs_joined_single_years$"Associate's Degree"*(1-buffer_overlap_1km),
          "Bachelor's Degree 1km" =
            acs_joined_single_years$"Bachelor's Degree"*(1-buffer_overlap_1km),
          "Master's Degree 1km" =
            acs_joined_single_years$"Master's Degree"*(1-buffer_overlap_1km),
          "Professional School Degree 1km" =
            acs_joined_single_years$"Professional School Degree"*(1-buffer_overlap_1km),
          "Doctorate Degree 1km" =
            acs_joined_single_years$"Doctorate Degree"*(1-buffer_overlap_1km),
          "More Than High School Diploma 1km" =
            acs_joined_single_years$"More Than High School Diploma"*(1-buffer_overlap_1km)) %>%
  select(c(43:69))

summary_1km_outside <- summary_1km_outside[,-c(1)] %>%
  aggregate (by = data.frame(summary_1km_outside$year), sum)

summary_1km_outside <- cbind(summary_1km_outside[, c(1)], 
                      summary_1km_outside[,c(2:13)]/summary_1km_outside$"Total Population 1km", 
                      summary_1km_outside[,c(14:16)]/summary_1km_outside$"Household Poverty Universe 1km",
                      summary_1km_outside[,c(17:27)]/summary_1km_outside$"Education Universe 1km")




summary_3km_outside <- acs_joined_single_years %>%
  mutate ("Total Population 3km" = 
            acs_joined_single_years$"Total Population"*(1-buffer_overlap_3km),
          "White Alone 3km" = 
            acs_joined_single_years$"White Alone"*(1-buffer_overlap_3km),
          "Black or African American Alone 3km" = 
            acs_joined_single_years$"Black or African American Alone"*(1-buffer_overlap_3km),
          "American Indian and Alaska Native Alone 3km" = 
            acs_joined_single_years$"American Indian and Alaska Native Alone"*(1-buffer_overlap_3km),
          "Asian Alone 3km" = 
            acs_joined_single_years$"Asian Alone"*(1-buffer_overlap_3km),
          "Native Hawaiian and Other Pacific Islander Alone 3km" = 
            acs_joined_single_years$"Native Hawaiian and Other Pacific Islander Alone"*(1-buffer_overlap_3km),
          "Some Other Race Alone 3km" = 
            acs_joined_single_years$"Some Other Race Alone"*(1-buffer_overlap_3km),
          "Two or More Races 3km" = 
            acs_joined_single_years$"Two or More Races"*(1-buffer_overlap_3km),
          "Two Races Including Some Other Race 3km" = 
            acs_joined_single_years$"Two Races Including Some Other Race"*(1-buffer_overlap_3km),
          "Two Races Excluding Some Other Race, And Three or More Races 3km" = 
            acs_joined_single_years$"Two Races Excluding Some Other Race, And Three or More Races"*(1-buffer_overlap_3km),
          "Not Hispanic or Latino 3km" = 
            acs_joined_single_years$"Not Hispanic or Latino"*(1-buffer_overlap_3km),
          "Hispanic or Latino 3km" = 
            acs_joined_single_years$"Hispanic or Latino"*(1-buffer_overlap_3km),
          
          "Household Poverty Universe 3km" = 
            acs_joined_single_years$"Household Poverty Universe"*(1-buffer_overlap_3km),
          "Income in Past 12 Months Below Poverty Level 3km" = 
            acs_joined_single_years$"Income in Past 12 Months Below Poverty Level"*(1-buffer_overlap_3km), 
          "Income in Past 12 Months at or Above Poverty Level 3km" = 
            acs_joined_single_years$"Income in Past 12 Months at or Above Poverty Level"*(1-buffer_overlap_3km),
          
          "Education Universe 3km" = 
            acs_joined_single_years$"Education Universe"*(1-buffer_overlap_3km),
          "Less Than High School Diploma 3km" = 
            acs_joined_single_years$"Less Than High School Diploma"*(1-buffer_overlap_3km),
          "High School Diploma 3km" =
            acs_joined_single_years$"High School Diploma"*(1-buffer_overlap_3km),
          "Some College 3km" =
            acs_joined_single_years$"Some College"*(1-buffer_overlap_3km),
          "Associate's Degree 3km" =
            acs_joined_single_years$"Associate's Degree"*(1-buffer_overlap_3km),
          "Bachelor's Degree 3km" =
            acs_joined_single_years$"Bachelor's Degree"*(1-buffer_overlap_3km),
          "Master's Degree 3km" =
            acs_joined_single_years$"Master's Degree"*(1-buffer_overlap_3km),
          "Professional School Degree 3km" =
            acs_joined_single_years$"Professional School Degree"*(1-buffer_overlap_3km),
          "Doctorate Degree 3km" =
            acs_joined_single_years$"Doctorate Degree"*(1-buffer_overlap_3km),
          "More Than High School Diploma 3km" =
            acs_joined_single_years$"More Than High School Diploma"*(1-buffer_overlap_3km)) %>%
  select(c(43:69))

summary_3km_outside <- summary_3km_outside[,-c(1)] %>%
  aggregate (by = data.frame(summary_3km_outside$year), sum)

summary_3km_outside <- cbind(summary_3km_outside[, c(1)], 
                      summary_3km_outside[,c(2:13)]/summary_3km_outside$"Total Population 3km", 
                      summary_3km_outside[,c(14:16)]/summary_3km_outside$"Household Poverty Universe 3km",
                      summary_3km_outside[,c(17:27)]/summary_3km_outside$"Education Universe 3km")

```

Plot 
```{r, echo = FALSE}
melted_summary_3km <- melt(summary_3km [,c(1, 12, 13)], id.vars = "summary_3km[, c(1)]")
melted_summary_3km_outside <- melt(summary_3km_outside [,c(1, 12, 13)], id.vars = "summary_3km_outside[, c(1)]")

ggplot(melted_summary_3km) +
   geom_line(aes(x = melted_summary_3km$"summary_3km[, c(1)]", y = value/melted_summary_3km_outside$value, group = variable, color = variable)) +
   geom_hline(yintercept = 1, linetype = "dashed")

```


```{r, echo = FALSE}
melted_summary_3km <- melt(summary_3km [,c(1, 19, 20, 27)], id.vars = "summary_3km[, c(1)]")
melted_summary_3km_outside <- melt(summary_3km_outside [,c(1, 19, 20, 27)], id.vars = "summary_3km_outside[, c(1)]")

ggplot(melted_summary_3km) +
   geom_line(aes(x = melted_summary_3km$"summary_3km[, c(1)]", y = value/melted_summary_3km_outside$value, group = variable, color = variable)) +
   geom_hline(yintercept = 1, linetype = "dashed")
```


